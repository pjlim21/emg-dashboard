<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EMG Configuration Dashboard</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <h2>EMG Dashboard</h2>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" data-page="overview">
                        <span class="nav-icon">üìä</span>
                        Dashboard Overview
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="configurations">
                        <span class="nav-icon">‚öôÔ∏è</span>
                        Configuration Management
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="body-diagram">
                        <span class="nav-icon">üßç</span>
                        Body Diagram
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="sessions">
                        <span class="nav-icon">üìã</span>
                        Session Management
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="analytics">
                        <span class="nav-icon">üìà</span>
                        Analytics & Reports
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Dashboard Overview Page -->
            <div id="overview" class="page active">
                <div class="page-header">
                    <h1>Dashboard Overview</h1>
                    <p>Welcome to your EMG Configuration Management System</p>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="total-configs">0</div>
                        <div class="stat-label">Total Configurations</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-sessions">0</div>
                        <div class="stat-label">Total Sessions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="active-muscles">0</div>
                        <div class="stat-label">Active Muscle Groups</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avg-snr">0</div>
                        <div class="stat-label">Average SNR (dB)</div>
                    </div>
                </div>

                <div class="quick-actions">
                    <h3>Quick Actions</h3>
                    <div class="action-buttons">
                        <button class="btn btn--primary" onclick="navigateToPage('configurations')">Add New Configuration</button>
                        <button class="btn btn--secondary" onclick="navigateToPage('sessions')">Start New Session</button>
                        <button class="btn btn--outline" onclick="navigateToPage('body-diagram')">View Body Diagram</button>
                    </div>
                </div>

                <div class="recent-activity">
                    <h3>Recent Activity</h3>
                    <div id="recent-activity-list" class="activity-list">
                        <!-- Recent activity items will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Configuration Management Page -->
            <div id="configurations" class="page">
                <div class="page-header">
                    <h1>Configuration Management</h1>
                    <button class="btn btn--primary" onclick="showAddConfigForm()">Add New Configuration</button>
                </div>

                <div class="search-filters">
                    <input type="text" class="form-control" id="config-search" placeholder="Search configurations...">
                    <select class="form-control" id="electrode-filter">
                        <option value="">All Electrode Types</option>
                        <option value="bipolar">Bipolar</option>
                        <option value="monopolar">Monopolar</option>
                        <option value="multichannel">Multi-channel</option>
                    </select>
                </div>

                <div id="configurations-list" class="configurations-list">
                    <!-- Configuration cards will be populated here -->
                </div>

                <!-- Add Configuration Modal -->
                <div id="add-config-modal" class="modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Add New Configuration</h3>
                            <button class="modal-close" onclick="hideAddConfigForm()">&times;</button>
                        </div>
                        <form id="add-config-form" class="modal-body">
                            <div class="form-group">
                                <label class="form-label">Configuration Name</label>
                                <input type="text" class="form-control" name="name" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Electrode Type</label>
                                <select class="form-control" name="electrodeType" required>
                                    <option value="">Select electrode type</option>
                                    <option value="bipolar">Bipolar</option>
                                    <option value="monopolar">Monopolar</option>
                                    <option value="multichannel">Multi-channel</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Target Muscle Group</label>
                                <select class="form-control" name="muscleGroup" required>
                                    <option value="">Select muscle group</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Electrode Specifications</label>
                                <input type="text" class="form-control" name="specs" placeholder="e.g., Ag/AgCl, 10mm diameter, <5kŒ© impedance">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Placement Notes</label>
                                <textarea class="form-control" name="placement" rows="3" placeholder="Describe electrode placement..."></textarea>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn--secondary" onclick="hideAddConfigForm()">Cancel</button>
                                <button type="submit" class="btn btn--primary">Save Configuration</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Body Diagram Page -->
            <div id="body-diagram" class="page">
              <div class="page-header">
                <h1>Interactive Body Diagram</h1>
                <p>Click on muscle groups to view or assign configurations</p>
              </div>
            
              <div class="body-diagram-container">
                <!-- 1Ô∏è‚É£ view toggle ‚Äì no inline JS  -->
                <div class="diagram-toggle">
                  <button class="btn btn--secondary diagram-toggle__btn" data-view="front">Front View</button>
                  <button class="btn btn--secondary diagram-toggle__btn" data-view="back" >Back View</button>
                </div>
            
                <!-- 2Ô∏è‚É£ empty holders ‚Äì app.js will draw the <path> elements -->
                <div class="body-diagrams">
                  <div id="front-body" class="body-view active"></div>
                  <div id="back-body"  class="body-view"></div>
                </div>
              </div>
            
              <!-- 3Ô∏è‚É£ side panel -->
              <div id="muscle-info-panel" class="muscle-info-panel">
                <h3 id="selected-muscle-name">Select a muscle group</h3>
                <div id="muscle-details" class="muscle-details">
                  <p>Click on a muscle group to view configuration details and options.</p>
                </div>
              </div>
            </div>

            <!-- Session Management Page -->
            <div id="sessions" class="page">
                <div class="page-header">
                    <h1>Session Management</h1>
                    <button class="btn btn--primary" onclick="showAddSessionForm()">Create New Session</button>
                </div>

                <div id="sessions-list" class="sessions-list">
                    <!-- Session cards will be populated here -->
                </div>

                <!-- Add Session Modal -->
                <div id="add-session-modal" class="modal">
                    <div class="modal-content large">
                        <div class="modal-header">
                            <h3>Create New Session</h3>
                            <button class="modal-close" onclick="hideAddSessionForm()">&times;</button>
                        </div>
                        <form id="add-session-form" class="modal-body">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Session Name</label>
                                    <input type="text" class="form-control" name="name" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Configuration</label>
                                    <select class="form-control" name="configuration" required>
                                        <option value="">Select configuration</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Subject ID</label>
                                    <input type="text" class="form-control" name="subject" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Date</label>
                                    <input type="date" class="form-control" name="date" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Session Notes</label>
                                <textarea class="form-control" name="notes" rows="3"></textarea>
                            </div>

                            <div class="file-upload-section">
                                <h4>Data Upload</h4>
                                <div class="upload-area" id="raw-signal-upload">
                                    <p>Drag & drop raw signal files here or click to browse</p>
                                    <input type="file" accept=".txt,.dat,.bin" multiple>
                                </div>
                                <div class="upload-area" id="csv-data-upload">
                                    <p>Drag & drop CSV data files here or click to browse</p>
                                    <input type="file" accept=".csv" multiple>
                                </div>
                            </div>

                            <div class="metrics-section">
                                <h4>Session Metrics</h4>
                                <div id="metrics-inputs" class="metrics-inputs">
                                    <!-- Metric input fields will be populated here -->
                                </div>
                                <button type="button" class="btn btn--outline" onclick="addCustomMetric()">Add Custom Metric</button>
                            </div>

                            <div class="modal-footer">
                                <button type="button" class="btn btn--secondary" onclick="hideAddSessionForm()">Cancel</button>
                                <button type="submit" class="btn btn--primary">Create Session</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Analytics Page -->
            <div id="analytics" class="page">
                <div class="page-header">
                    <h1>Analytics & Reports</h1>
                    <button class="btn btn--outline" onclick="exportData()">Export Data</button>
                </div>

                <div class="analytics-grid">
                    <div class="card analytics-card">
                        <div class="card__header">
                            <h3>Signal Quality Trends</h3>
                        </div>
                        <div class="card__body">
                            <canvas id="signal-quality-chart" width="400" height="200"></canvas>
                        </div>
                    </div>

                    <div class="card analytics-card">
                        <div class="card__header">
                            <h3>Configuration Performance</h3>
                        </div>
                        <div class="card__body">
                            <canvas id="configuration-chart" width="400" height="200"></canvas>
                        </div>
                    </div>

                    <div class="card analytics-card">
                        <div class="card__header">
                            <h3>Muscle Group Activity</h3>
                        </div>
                        <div class="card__body">
                            <canvas id="muscle-activity-chart" width="400" height="200"></canvas>
                        </div>
                    </div>

                    <div class="card analytics-card">
                        <div class="card__header">
                            <h3>Recent Performance Summary</h3>
                        </div>
                        <div class="card__body">
                            <div id="performance-summary" class="performance-summary">
                                <!-- Performance metrics will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>
    <script type="module">
      import { bodyFront } from './assets/bodyFront.js';
      import { bodyBack  } from './assets/bodyBack.js';
      import EMGDashboard from './app.js';
    
      /* make the instance visible to inline handlers */
      window.emgDashboard = new EMGDashboard(bodyFront, bodyBack);
    
  /* wire the view-toggle buttons */
      document.querySelectorAll('.diagram-toggle__btn').forEach(btn => {
        btn.addEventListener('click', () => {
          /* switch active button */
          document.querySelectorAll('.diagram-toggle__btn')
                  .forEach(b => b.classList.toggle('active', b === btn));
    
          /* swap view inside the class */
          emgDashboard.currentBodyView = btn.dataset.view;
          document.querySelectorAll('.body-view').forEach(view => {
            view.classList.toggle('active', view.id.startsWith(btn.dataset.view));
          });
          emgDashboard.renderBodyDiagram();   // draw correct side
        });
      });
    </script>
</body>
</html>
